\subsection{Test specification}

\subsubsection{Unit Tests}
Visual Studio Code plugins can be tested with standard javascript testing frameworks like Mocha or Jasmine, if they don't use any features of Visual Studio Code itself. This allows to test core logic without the need to run tests inside VS Code.

\subsubsection{Integration Tests}
VS Code extensions which require VS Code API can be tested with help of a special instance of VS Code. Inside this instance, the extension can use the full API and tests can execute commands like creating a new file, entering a character, using auto-completion and verifing if the extension works as expected.   

\subsubsection{Test overview}
To verify that the Dafny VSCode Plugin is working as expected, it has to be properly tested. Therefore exists two possibilities. Either automatic unit / integration tests or manual testing. The best would be to test everything automatically. Unfortunately this is not possible, though the VSCode Test API provides a rich set of methods, but no direct access to the filesystem or to wait for certain tasks to finish. For this reason some tests have to be performed manually, especially use cases which installs Dafny and rely heavily on scripts. On the other side if all automatic tests fail, it's mostly a clear signal that something with the server is not okay. So the automatically tests also verifies if the DafnyServer is working correctly. During development it is also quite easy to verify certain features on the fly. 
Below you first find what is tested and how, followed by table which explains how the individual use cases are tested and guides for manual testing. 

\subsubsection{Test scope}
As discussed in the last chapter, that not everything can be easily tested, the test scope has to be restricted. The following table shows which system component tested and how.
\begin{longtable}{ p{0.3\textwidth} | p{0.2\textwidth} | p{0.4\textwidth} }
\textbf{System component} & \textbf{Tested} & \textbf{Description}\\
	Installation of plugin & Manual & Manual installation of Dafny and setting of paths   \\
	Automatic installation of Dafny & Manual & Easier to validate that all configurations are set correctly \\
	Uninstallation of Dafny & Manual & Verify on filesystem level\\
	Communication DafnyServer and Plugin & Manual + Automatic & Test if output from DafnyServer is correctly parsed and displayed\\
	Restart DafnyServer task & Manual & Check if a new PID is used and the other is stopped\\
	Local queue & Manual & DafnyServer can be paused in Visual Studio and queueing can be checked \\
	Syntax highlighting & Manual & Look on our example \\
	Verification on typing & Manual & Easy to test manually\\
	Snippets & Manual & Check if snippets are working\\
	Document Symbol Provider & Automatic & Can be tested with the VSCode API easily \\
	Hover Provider & Automatic & Can be tested with the VSCode API easily \\
	Definition Provider & Automatic & Can be tested with the VSCode API easily  \\
	Code Lens & Automatic & Can be tested with the VSCode API easily \\
\end{longtable}
All the automatic tests also tests if the DafnyServer and DafnyDef are communicate correctly with each other. 


\subsubsection{Use Case Tests}
\begin{longtable}{ p{0.4\textwidth} | p{0.6\textwidth} }
	\textbf{Use Case} & \textbf{Verify}\\
	UC1: Easy installation of Dafny plugin\newline & 
		The language dafny is available\newline 
		.dfy files are associated with the dafny plugin\newline
		The server is started\newline
		The status is changed after the file have been checked\newline
		If the server crashes, this is reported and the server is restarted\newline
		The plugin automatically downloads and installs dafny\newline
		Sets the dafny server path \newline
		Shows a message if .Net framework or mono is missing
	\\
	UC2: Syntax Highlighting & 
		Syntax is highlighted
	\\
	UC3: Reporting of Dafny best practices violations &
		\todo{?}
 	\\
	UC4: Automatic generation of contracts & \todo{Invariant: Require and ensures are generated?} \\
	UC5: Autocompletion for identifiers & 
		Autocompletion is working for all known dafny identifiers\newline
		Methods are considered for autocompletion as well
		
	
	\\
\end{longtable}


\subsubsection{UC1}
The following steps have to be walked trough, to see if the plugin works as expected:

\paragraph{Manual installation}
\textbf{\newline Steps:}
\begin{enumerate}
\item Uninstall the plugin and remove Dafny (/home/.Dafny or \%AppData\%/Roaming/Dafny)
\item Remove the entry "dafny.basePath" from the user configuration file 
\item Restart VSCode - There should be an error that Dafny is not installed
\item Install Dafny from \href{https://github.com/FunctionalCorrectness/dafny-microsoft/releases}{https://github.com/FunctionalCorrectness/dafny-microsoft/releases}
\item Set "dafny.basePath" to the extracted archive location
\item Open the file simpleTest.dfy
\item Execute "Dafny: RestartServer" task
\end{enumerate}
\textbf{\newline Expected:}
The DafnyServer should be started and the file verified. This can be seen from the statusbar. On the right side, there should be the PID of the DafnyServer and on the left side the status "Verified"

\paragraph{Status change}
\textbf{\newline Steps:}
\begin{enumerate}
	\item Open the file invalidAsserts.dfy

\end{enumerate}
\textbf{\newline Expected:}
The server should start first and afterwards the status should display "Verifiying". After the DafnyServer verified the program, the status should have been changed to "Not Verified" and multiple asserts are marked red. 

\paragraph{Server crash}
\textbf{\newline Steps:}
\begin{enumerate}
	\item Open the file simpleTest.dfy
	\item The server should be started and the file verified
	\item Kill the DafnyServer process
	
\end{enumerate}
\textbf{\newline Expected:}
The server should be restarting automatically, with corresponding messages inside VSCode. 

\paragraph{Automatic installation}
\textbf{\newline Steps:}
\begin{enumerate}
\item Uninstall the Server with "Dafny: Uninstall DafnyServer" task
\item Restart VSCode - There should be an error that Dafny is not installed
\item Open the file simpleTest.dfy
\item Install Dafny with the task "Dafny: Install DafnyServer" 
\end{enumerate}
\textbf{\newline Expected:}
Dafny should be downloaded, extracted, started and the file verified. See UC1, UC2, UC3 Expected


\paragraph{UC2}
Syntax Highlighting won't be directly tested. All our test programs have been reviewed that the syntax highlighting looks fine.  

\paragraph{UC3}
\todo{Has to be defined}


\paragraph{UC4}
\todo{Has to be defined}

\paragraph{UC5}
Autocompletion can be tested with the VSCode Test API. Therefore a file is loaded with a set of methods. Afterwards some test check if the existing methods are considered for autocompletion. Additionally more refactoring tests will be performed under this use case. 
